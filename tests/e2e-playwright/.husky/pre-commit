#!/usr/bin/env sh

# Get the directory where this hook is located
HOOK_DIR="$(dirname "$0")"
E2E_DIR="$(dirname "$HOOK_DIR")"

# Check if staged files are in tests/e2e-playwright directory
STAGED_E2E_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep "^tests/e2e-playwright/" | grep "\.ts$" || true)

if [ -n "$STAGED_E2E_FILES" ]; then
  echo "ğŸ” Running E2E tests pre-commit checks..."

  # Change to e2e-playwright directory
  cd "$E2E_DIR"

  # Run TypeScript check
  echo "ğŸ“ Running TypeScript check..."
  npm run type-check
  if [ $? -ne 0 ]; then
    echo "âŒ TypeScript check failed. Please fix the errors before committing."
    exit 1
  fi
  echo "âœ… TypeScript check passed"

  # Run lint-staged for linting
  echo "ğŸ§¹ Running ESLint on staged files..."
  npx lint-staged
  if [ $? -ne 0 ]; then
    echo "âŒ ESLint check failed. Please fix the errors before committing."
    exit 1
  fi
  echo "âœ… ESLint check passed"

  echo "âœ… All E2E pre-commit checks passed!"
fi

